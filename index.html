<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Elit's Büfe — Menü</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="robots" content="noindex">
  <style>
    :root{--bg:#000;--accent:#ffcc00;--muted:#ddd;--text:#fff}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{display:flex;flex-direction:column;height:100vh}
    header{height:56px;display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:rgba(0,0,0,.6);backdrop-filter:blur(4px)}
    .title{font-weight:700}
    .controls{display:flex;gap:8px}
    .btn{background:var(--accent);color:#111;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:700;border:0;cursor:pointer}
    .linkbtn{background:transparent;border:1px solid rgba(255,255,255,.12);color:var(--text);padding:8px 10px;border-radius:8px;text-decoration:none}
    main{flex:1;position:relative}
    iframe, object, embed, canvas{position:absolute;inset:0;width:100%;height:100%;border:0;background:#111}
    #loading{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);color:var(--muted);z-index:20;text-align:center}
    .fallbackBox{position:absolute;left:50%;top:55%;transform:translate(-50%,-50%);text-align:center;z-index:30;display:none}
    .refreshSmall{background:transparent;border:1px solid rgba(255,255,255,.08);padding:6px;border-radius:8px;color:var(--muted);font-size:13px}
    .pdfPagesContainer{position:absolute;inset:0;overflow:auto;padding:12px;box-sizing:border-box}
    .pdfPageCanvas{display:block;margin:10px auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.6);background:#fff}
    @media(max-width:420px){ header{height:48px;padding:6px 8px} .title{font-size:15px} }
  </style>
  <script src="https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Elit's Büfe — Menü</div>
      <div class="controls">
        <button id="refreshBtn" class="refreshSmall" title="Menüyü yenile (cache temizle)">Yenile</button>
        <a id="openRawBtn" class="btn" target="_blank" rel="noopener">Menüyü Yeni Sekmede Aç</a>
      </div>
    </header>

    <main>
      <div id="loading">Menü yükleniyor…</div>
      <iframe id="pdfFrame" src="" allowfullscreen></iframe>
      <embed id="pdfEmbed" src="" type="application/pdf" style="display:none" />
      <object id="pdfObject" data="" type="application/pdf" aria-label="Elit's Büfe Menü" style="display:none"></object>
      <div id="pdfPagesContainer" class="pdfPagesContainer" style="display:none"></div>
      <div class="fallbackBox" id="fallbackBox">
        <p style="color:var(--muted);margin-bottom:12px">Tarayıcınız PDF gömmeyi desteklemiyor veya dosya yüklenemedi.</p>
        <a id="fallbackOpen" class="btn" target="_blank" rel="noopener">Menüyü Aç / İndir</a>
      </div>
    </main>
  </div>

<script>
(function(){
  const RELATIVE_PDF = 'menu.pdf';
  const RAW_PDF = 'https://raw.githubusercontent.com/BerkeA111/berkea111.github.io/main/menu.pdf';
  const frame = document.getElementById('pdfFrame');
  const embed = document.getElementById('pdfEmbed');
  const obj = document.getElementById('pdfObject');
  const loading = document.getElementById('loading');
  const fallbackBox = document.getElementById('fallbackBox');
  const fallbackOpen = document.getElementById('fallbackOpen');
  const openRawBtn = document.getElementById('openRawBtn');
  const refreshBtn = document.getElementById('refreshBtn');
  const pdfPagesContainer = document.getElementById('pdfPagesContainer');

  function makeCacheBuster(){ return Date.now(); }
  function isIOS(){
    return /iP(hone|od|ad)/.test(navigator.platform) || (navigator.userAgent.includes('Macintosh') && 'ontouchend' in document);
  }
  const IOS_PDF_HASH = '#view=FitH';
  const GENERIC_PDF_HASH = '';
  function urlWithV(base){
    const u = base + '?v=' + makeCacheBuster();
    return isIOS() ? u + IOS_PDF_HASH : u + GENERIC_PDF_HASH;
  }

  openRawBtn.href = urlWithV(RAW_PDF);
  fallbackOpen.href = urlWithV(RAW_PDF);

  async function handleIOS(){
    frame.style.display = 'none';
    embed.style.display = 'none';
    obj.style.display = 'none';
    fallbackBox.style.display = 'none';
    loading.style.display = 'block';
    loading.textContent = 'iOS için menü hazırlanıyor…';

    const pdfUrl = RELATIVE_PDF + '?v=' + makeCacheBuster();

    try{
      const resp = await fetch(pdfUrl, { cache: 'no-store' });
      if(resp.ok){
        const blob = await resp.blob();
        const blobUrl = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = 'menu.pdf';
        document.body.appendChild(a);
        a.click();
        setTimeout(()=>{
          document.body.removeChild(a);
          URL.revokeObjectURL(blobUrl);
        }, 1500);
      }
    }catch(e){
      console.warn('Otomatik indirme başarısız:', e);
    }

    try{
      pdfPagesContainer.innerHTML = '';
      pdfPagesContainer.style.display = 'block';
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.worker.min.js';
      const loadingTask = pdfjsLib.getDocument(pdfUrl);
      const pdf = await loadingTask.promise;
      const pageCount = Math.min(5, pdf.numPages);
      for(let p=1; p<=pageCount; p++){
        const page = await pdf.getPage(p);
        const viewport = page.getViewport({ scale:1 });
        const containerWidth = Math.max(document.documentElement.clientWidth - 24, 200);
        const scale = containerWidth / viewport.width;
        const scaledViewport = page.getViewport({ scale });
        const canvas = document.createElement('canvas');
        canvas.className = 'pdfPageCanvas';
        const outputScale = window.devicePixelRatio || 1;
        canvas.width = Math.floor(scaledViewport.width * outputScale);
        canvas.height = Math.floor(scaledViewport.height * outputScale);
        canvas.style.width = Math.floor(scaledViewport.width) + 'px';
        canvas.style.height = Math.floor(scaledViewport.height) + 'px';
        const ctx = canvas.getContext('2d');
        ctx.setTransform(outputScale, 0, 0, outputScale, 0, 0);
        pdfPagesContainer.appendChild(canvas);
        await page.render({ canvasContext: ctx, viewport: scaledViewport }).promise;
      }
      loading.style.display = 'none';
    }catch(err){
      console.error('iOS render hatası', err);
      loading.style.display = 'none';
      showFallback();
    }
  }

  function tryEmbed(){
    if(isIOS()){ handleIOS(); return; }
    frame.style.display = 'none';
    embed.style.display = 'none';
    obj.style.display = 'none';
    fallbackBox.style.display = 'none';

    const embedUrl = urlWithV(RELATIVE_PDF);
    frame.src = embedUrl;
    frame.style.display = 'block';
    loading.style.display = 'block';
    let loaded = false;
    const loadTimeout = setTimeout(()=>{
      if(!loaded) tryEmbedTag();
    }, 3500);

    frame.onload = function(){ loaded=true; clearTimeout(loadTimeout); loading.style.display='none'; };
    frame.onerror = function(){ clearTimeout(loadTimeout); tryEmbedTag(); };
  }

  function tryEmbedTag(){
    frame.style.display = 'none';
    obj.style.display = 'none';
    const eUrl = urlWithV(RELATIVE_PDF);
    embed.src = eUrl;
    embed.style.display = 'block';
    loading.style.display = 'block';
    let embedLoaded = false;
    const embTimeout = setTimeout(()=>{
      if(!embedLoaded) tryObject();
    }, 3000);
    try{ embed.onload = function(){ embedLoaded=true; clearTimeout(embTimeout); loading.style.display='none'; }; }catch(e){}
  }

  function tryObject(){
    frame.style.display = 'none';
    embed.style.display = 'none';
    const objUrl = urlWithV(RELATIVE_PDF);
    obj.data = objUrl;
    obj.style.display = 'block';
    loading.textContent = 'Menü yükleniyor...';
    loading.style.display = 'block';
    let objLoaded=false;
    const objTimeout = setTimeout(()=>{
      if(!objLoaded) showFallback();
    }, 3500);
    try{ obj.onload = function(){ objLoaded=true; clearTimeout(objTimeout); loading.style.display='none'; }; }catch(e){}
  }

  function showFallback(){
    loading.style.display = 'none';
    fallbackBox.style.display = 'block';
    fallbackOpen.href = urlWithV(RAW_PDF);
  }

  refreshBtn.addEventListener('click', function(){
    pdfPagesContainer.innerHTML = '';
    tryEmbed();
  });

  tryEmbed();

  setTimeout(()=>{
    const fVisible = frame.style.display !== 'none';
    const oVisible = obj.style.display !== 'none';
    const eVisible = embed.style.display !== 'none';
    const pVisible = pdfPagesContainer.style.display !== 'none';
    if(!fVisible && !oVisible && !eVisible && !pVisible) showFallback();
  },10000);
})();
</script>
</body>
  </html>
